# Analisis Operasional Tambang - PT. BBAG

Aplikasi web modern untuk analisis dan visualisasi data operasional tambang harian. Dibuat untuk PT. Bahtera Berkah Abadi Grup (PT. BBAG), aplikasi ini membantu melacak Key Performance Indicators (KPI) penting seperti volume produksi, pencapaian target, total ritase, dan utilisasi unit.

## ‚ú® Fitur Utama

- **Dashboard Interaktif**: Visualisasi KPI utama dalam kartu metrik yang mudah dibaca.
- **Grafik Performa**: Grafik batang dan garis untuk membandingkan volume produksi harian dengan target.
- **Filter Data Dinamis**: Filter data berdasarkan rentang tanggal untuk analisis yang lebih spesifik.
- **Tabel Data Terkini**: Menampilkan log operasional terbaru langsung di dashboard.
- **Analisis Berbasis AI**: Memanfaatkan Google Gemini API untuk menghasilkan ringkasan, identifikasi masalah, dan rekomendasi strategis secara otomatis.
- **Backend Database**: Menggunakan **Supabase** untuk penyimpanan data yang persisten dan aman.
- **Panel Admin**:
  - Sistem login sederhana untuk akses ke manajemen data.
  - Input, edit, dan hapus data operasional harian melalui form.
  - **Manajemen Data Karyawan**: Tambah, lihat, edit, dan hapus data karyawan, termasuk URL foto.
  - **Manajemen Data Lanjutan**:
    - Cadangkan (backup) seluruh data operasional dan karyawan ke dalam satu file Excel.
    - Hapus semua data (operasional atau karyawan) secara permanen.
- **Desain Responsif**: Tampilan optimal di berbagai perangkat, dari desktop hingga mobile.

## üöÄ Teknologi yang Digunakan

- **Frontend**: React, TypeScript
- **Styling**: Tailwind CSS
- **Grafik**: Recharts
- **Backend (Database)**: Supabase
- **Manipulasi Excel**: SheetJS (xlsx)
- **AI & Generative AI**: Google Gemini API (`@google/genai`)
- **Build Tool**: Dijalankan langsung di browser menggunakan ES Modules dan Import Maps.

## üõ†Ô∏è Panduan Memulai

Aplikasi ini dirancang untuk berjalan langsung di browser dan terhubung ke backend Supabase.

### Prasyarat

1.  **Akun Supabase**: Anda memerlukan akun Supabase gratis untuk membuat database.
2.  **API Key Google Gemini**: Anda memerlukan API Key dari Google AI Studio untuk menggunakan fitur analisis AI.
3.  Browser modern yang mendukung ES Modules (Chrome, Firefox, Edge, Safari).

### 1. Database Setup (Supabase)

1.  **Buat Proyek Baru**: Login ke [Supabase](https://supabase.com/) dan buat proyek baru. Simpan **Project URL** dan **anon (public) key** Anda.
2.  **Buka SQL Editor**: Buka **SQL Editor** di dashboard Supabase Anda. Salin dan jalankan skrip SQL **tunggal** di bawah ini untuk membuat atau memperbarui semua tabel dan kebijakan keamanan yang diperlukan. Skrip ini aman untuk dijalankan beberapa kali.

```sql
-- =================================================================
-- SKRIP SQL LENGKAP UNTUK APLIKASI ANALISIS OPERASIONAL TAMBANG
-- =================================================================
-- Skrip ini akan membuat tabel `operational_data` dan `karyawan`
-- serta mengkonfigurasi Row Level Security (RLS) yang diperlukan.
-- Aman untuk dijalankan kembali karena menggunakan `IF NOT EXISTS`.
-- =================================================================

-- -----------------------------------------------------------------
-- Tabel 1: operational_data
-- Menyimpan semua data log operasional harian.
-- -----------------------------------------------------------------

-- Membuat tabel jika belum ada
CREATE TABLE IF NOT EXISTS public.operational_data (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  date DATE NOT NULL UNIQUE,
  pro NUMERIC DEFAULT 0,
  stb NUMERIC DEFAULT 0,
  bd NUMERIC DEFAULT 0,
  wt NUMERIC DEFAULT 0,
  pa NUMERIC DEFAULT 0,
  ua NUMERIC DEFAULT 0,
  ma NUMERIC DEFAULT 0,
  eu NUMERIC DEFAULT 0,
  ritase INTEGER DEFAULT 0,
  volume NUMERIC DEFAULT 0,
  "averageM3" NUMERIC DEFAULT 0,
  "targetM3" NUMERIC DEFAULT 0,
  pencapaian NUMERIC DEFAULT 0
);

-- Mengaktifkan Row Level Security (RLS) untuk keamanan
ALTER TABLE public.operational_data ENABLE ROW LEVEL SECURITY;

-- Menghapus policy lama untuk memastikan hanya policy terbaru yang diterapkan
DROP POLICY IF EXISTS "Allow public read access" ON public.operational_data;
DROP POLICY IF EXISTS "Allow public write access" ON public.operational_data;

-- Policy 1: Mengizinkan semua orang (termasuk pengguna anonim) untuk MEMBACA data.
CREATE POLICY "Allow public read access" ON public.operational_data
FOR SELECT USING (true);

-- Policy 2: Mengizinkan semua orang untuk MENULIS (insert, update, delete) data.
-- PERINGATAN: Kebijakan ini sangat permisif dan cocok untuk demo/prototipe.
-- Untuk aplikasi produksi, Anda HARUS membatasi akses tulis ini
-- hanya untuk pengguna yang terautentikasi dan berwenang.
CREATE POLICY "Allow public write access" ON public.operational_data
FOR ALL USING (true) WITH CHECK (true);


-- -----------------------------------------------------------------
-- Tabel 2: karyawan
-- Menyimpan data karyawan perusahaan.
-- -----------------------------------------------------------------

-- Membuat tabel jika belum ada, dengan urutan kolom yang telah disesuaikan.
CREATE TABLE IF NOT EXISTS public.karyawan (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    -- Informasi Pekerjaan
    departemen TEXT,
    divisi TEXT,
    posisi TEXT,
    status TEXT DEFAULT 'Aktif',
    tanggal_bergabung DATE,
    masa_kontrak TEXT,
    foto_url TEXT,
    -- Data Diri & Kontak
    nama TEXT NOT NULL,
    nik TEXT UNIQUE,
    alamat_ktp TEXT,
    alamat_sekarang TEXT,
    jenis_kelamin TEXT,
    tempat_lahir TEXT,
    tanggal_lahir DATE,
    agama TEXT,
    golongan_darah TEXT,
    nomor_hp TEXT,
    -- Keluarga
    status_perkawinan TEXT,
    nama_ayah TEXT,
    pekerjaan_ayah TEXT,
    nama_ibu TEXT,
    pekerjaan_ibu TEXT,
    nama_pasangan TEXT,
    nama_anak1 TEXT,
    nama_anak2 TEXT,
    nama_anak3 TEXT,
    -- Riwayat Pendidikan
    pendidikan_terakhir TEXT,
    pendidikan_sd TEXT,
    pendidikan_smp TEXT,
    pendidikan_sma TEXT,
    pendidikan_s1 TEXT,
    fakultas_s1 TEXT,
    -- Riwayat Pekerjaan Terakhir
    perusahaan_terakhir TEXT,
    alamat_perusahaan_terakhir TEXT,
    alasan_berhenti TEXT,
    lama_bekerja_terakhir TEXT,
    posisi_terakhir TEXT,
    gaji_terakhir NUMERIC,
    -- Lain-lain
    ukuran_sepatu TEXT,
    ukuran_baju TEXT,
    hobi TEXT,
    tujuan_liburan TEXT,
    moto_hari_ini TEXT
);

-- Mengganti nama kolom 'alamat' menjadi 'alamat_ktp' jika ada dan belum diganti.
-- Ini untuk menjaga kompatibilitas dengan skema tabel yang lama.
DO $$
BEGIN
   IF EXISTS(SELECT 1 FROM information_schema.columns WHERE table_name='karyawan' AND column_name='alamat')
   AND NOT EXISTS(SELECT 1 FROM information_schema.columns WHERE table_name='karyawan' AND column_name='alamat_ktp') THEN
      ALTER TABLE public.karyawan RENAME COLUMN alamat TO alamat_ktp;
   END IF;
END $$;

-- Menambahkan semua kolom ke tabel 'karyawan' jika belum ada.
-- Ini membuat skrip aman untuk dijalankan kembali pada database yang sudah ada.
ALTER TABLE public.karyawan
  -- Data Diri
  ADD COLUMN IF NOT EXISTS jenis_kelamin TEXT,
  ADD COLUMN IF NOT EXISTS tempat_lahir TEXT,
  ADD COLUMN IF NOT EXISTS tanggal_lahir DATE,
  ADD COLUMN IF NOT EXISTS agama TEXT,
  ADD COLUMN IF NOT EXISTS golongan_darah TEXT,
  ADD COLUMN IF NOT EXISTS status_perkawinan TEXT,
  ADD COLUMN IF NOT EXISTS pendidikan_terakhir TEXT,
  -- Kontak & Alamat
  ADD COLUMN IF NOT EXISTS nomor_hp TEXT,
  ADD COLUMN IF NOT EXISTS alamat_ktp TEXT,
  ADD COLUMN IF NOT EXISTS alamat_sekarang TEXT,
  -- Pekerjaan
  ADD COLUMN IF NOT EXISTS departemen TEXT,
  ADD COLUMN IF NOT EXISTS divisi TEXT,
  ADD COLUMN IF NOT EXISTS masa_kontrak TEXT,
  ADD COLUMN IF NOT EXISTS foto_url TEXT,
  -- Keluarga
  ADD COLUMN IF NOT EXISTS nama_ayah TEXT,
  ADD COLUMN IF NOT EXISTS pekerjaan_ayah TEXT,
  ADD COLUMN IF NOT EXISTS nama_ibu TEXT,
  ADD COLUMN IF NOT EXISTS pekerjaan_ibu TEXT,
  ADD COLUMN IF NOT EXISTS nama_pasangan TEXT,
  ADD COLUMN IF NOT EXISTS nama_anak1 TEXT,
  ADD COLUMN IF NOT EXISTS nama_anak2 TEXT,
  ADD COLUMN IF NOT EXISTS nama_anak3 TEXT,
  -- Riwayat Pendidikan Detail
  ADD COLUMN IF NOT EXISTS pendidikan_sd TEXT,
  ADD COLUMN IF NOT EXISTS pendidikan_smp TEXT,
  ADD COLUMN IF NOT EXISTS pendidikan_sma TEXT,
  ADD COLUMN IF NOT EXISTS pendidikan_s1 TEXT,
  ADD COLUMN IF NOT EXISTS fakultas_s1 TEXT,
  -- Riwayat Pekerjaan
  ADD COLUMN IF NOT EXISTS perusahaan_terakhir TEXT,
  ADD COLUMN IF NOT EXISTS alamat_perusahaan_terakhir TEXT,
  ADD COLUMN IF NOT EXISTS posisi_terakhir TEXT,
  ADD COLUMN IF NOT EXISTS lama_bekerja_terakhir TEXT,
  ADD COLUMN IF NOT EXISTS gaji_terakhir NUMERIC,
  ADD COLUMN IF NOT EXISTS alasan_berhenti TEXT,
  -- Informasi Lain
  ADD COLUMN IF NOT EXISTS ukuran_sepatu TEXT,
  ADD COLUMN IF NOT EXISTS ukuran_baju TEXT,
  ADD COLUMN IF NOT EXISTS hobi TEXT,
  ADD COLUMN IF NOT EXISTS tujuan_liburan TEXT,
  ADD COLUMN IF NOT EXISTS moto_hari_ini TEXT;


-- Mengaktifkan Row Level Security (RLS) untuk keamanan
ALTER TABLE public.karyawan ENABLE ROW LEVEL SECURITY;

-- Menghapus policy lama untuk memastikan hanya policy terbaru yang diterapkan
DROP POLICY IF EXISTS "Allow public read access for karyawan" ON public.karyawan;
DROP POLICY IF EXISTS "Allow public write access for karyawan" ON public.karyawan;

-- Policy 1: Mengizinkan semua orang (termasuk pengguna anonim) untuk MEMBACA data.
CREATE POLICY "Allow public read access for karyawan" ON public.karyawan
FOR SELECT USING (true);

-- Policy 2: Mengizinkan semua orang untuk MENULIS (insert, update, delete) data.
-- PERINGATAN: Sama seperti tabel operasional, batasi akses tulis ini
-- pada aplikasi produksi untuk keamanan.
CREATE POLICY "Allow public write access for karyawan" ON public.karyawan
FOR ALL USING (true) WITH CHECK (true);
```

### 2. Konfigurasi Aplikasi

1.  **Clone repositori ini** (jika berlaku) atau cukup unduh file-filenya.
2.  **Buka file `config.ts`**.
3.  **Konfigurasi Supabase**: Ganti placeholder di `SUPABASE_CONFIG` dengan **URL** dan **Kunci Anon** dari proyek Supabase Anda.
    ```typescript
    export const SUPABASE_CONFIG = {
      URL: 'https://YOR_PROJECT_ID.supabase.co', // <-- GANTI DENGAN URL ANDA
      ANON_KEY: 'YOUR_ANON_KEY', // <-- GANTI DENGAN KUNCI ANON ANDA
    };
    ```
4.  **Konfigurasi Gemini API**: Aplikasi ini mengambil API Key Gemini dari variabel lingkungan (`process.env.API_KEY`). Pastikan variabel ini tersedia di lingkungan tempat aplikasi dijalankan.
5.  **Buka `index.html`**:
    - Buka file `index.html` di browser Anda, atau layani folder proyek menggunakan server web lokal sederhana (misalnya, `npx serve`).

## ‚öôÔ∏è Konfigurasi Lainnya

Konfigurasi tambahan aplikasi dapat ditemukan di file `config.ts`. Di sini Anda dapat mengubah:
- Nama aplikasi dan perusahaan.
- Kredensial login admin (`ADMIN_CREDENTIALS`).
- Model Gemini yang digunakan (`GEMINI_CONFIG`).
- Pengaturan UI seperti warna grafik (`UI_CONFIG`).

## üìÇ Struktur Proyek

```
/
‚îú‚îÄ‚îÄ components/         # Komponen React yang dapat digunakan kembali
‚îÇ   ‚îú‚îÄ‚îÄ AdminPage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ AnalysisPanel.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ services/           # Logika untuk berinteraksi dengan API eksternal
‚îÇ   ‚îú‚îÄ‚îÄ geminiService.ts
‚îÇ   ‚îî‚îÄ‚îÄ supabaseClient.ts # Konfigurasi Supabase client
‚îú‚îÄ‚îÄ constants.ts        # Fungsi kalkulasi KPI
‚îú‚îÄ‚îÄ config.ts           # File konfigurasi utama aplikasi
‚îú‚îÄ‚îÄ types.ts            # Definisi tipe TypeScript
‚îú‚îÄ‚îÄ App.tsx             # Komponen utama aplikasi
‚îú‚îÄ‚îÄ index.tsx           # Titik masuk aplikasi React
‚îî‚îÄ‚îÄ index.html          # File HTML utama
```